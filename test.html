<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jigsaw Puzzle Tests</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 20px;
            background: #f5f5f5;
        }
        .test-container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        h1 {
            color: #667eea;
            margin-bottom: 10px;
        }
        .test-result {
            padding: 10px;
            margin: 10px 0;
            border-radius: 5px;
            border-left: 4px solid;
        }
        .test-result.pass {
            background: #d4edda;
            border-color: #28a745;
            color: #155724;
        }
        .test-result.fail {
            background: #f8d7da;
            border-color: #dc3545;
            color: #721c24;
        }
        .test-result.running {
            background: #fff3cd;
            border-color: #ffc107;
            color: #856404;
        }
        .summary {
            margin-top: 20px;
            padding: 20px;
            background: #667eea;
            color: white;
            border-radius: 5px;
            font-size: 1.2em;
            font-weight: bold;
        }
        .test-name {
            font-weight: 600;
            margin-bottom: 5px;
        }
        .test-detail {
            font-size: 0.9em;
            opacity: 0.8;
        }
        button {
            padding: 12px 24px;
            background: #667eea;
            color: white;
            border: none;
            border-radius: 5px;
            cursor: pointer;
            font-size: 1em;
            font-weight: 600;
            margin: 10px 10px 10px 0;
        }
        button:hover {
            background: #5568d3;
        }
        #appContainer {
            margin-top: 30px;
            border-top: 2px solid #ddd;
            padding-top: 30px;
        }
    </style>
</head>
<body>
    <div class="test-container">
        <h1>ðŸ§ª Jigsaw Puzzle App Tests</h1>
        <p>Automated tests to verify all functionality works correctly (12 tests).</p>
        
        <button onclick="runAllTests()">Run All Tests</button>
        <button onclick="clearResults()">Clear Results</button>
        
        <div id="testResults"></div>
        <div id="summary"></div>
        
        <div id="appContainer">
            <h2>Test Application Below:</h2>
            <iframe src="index.html" width="100%" height="800" style="border: 1px solid #ddd; border-radius: 5px;"></iframe>
        </div>
    </div>

    <script>
        let testResults = [];
        
        function clearResults() {
            testResults = [];
            document.getElementById('testResults').innerHTML = '';
            document.getElementById('summary').innerHTML = '';
        }
        
        function logTest(name, passed, detail = '') {
            const result = {
                name,
                passed,
                detail,
                timestamp: new Date().toISOString()
            };
            testResults.push(result);
            displayTest(result);
            updateSummary();
        }
        
        function displayTest(result) {
            const div = document.createElement('div');
            div.className = `test-result ${result.passed ? 'pass' : 'fail'}`;
            div.innerHTML = `
                <div class="test-name">${result.passed ? 'âœ“' : 'âœ—'} ${result.name}</div>
                ${result.detail ? `<div class="test-detail">${result.detail}</div>` : ''}
            `;
            document.getElementById('testResults').appendChild(div);
        }
        
        function updateSummary() {
            const passed = testResults.filter(r => r.passed).length;
            const total = testResults.length;
            const summaryDiv = document.getElementById('summary');
            summaryDiv.className = 'summary';
            summaryDiv.innerHTML = `
                Tests: ${passed}/${total} passed
                ${passed === total ? 'ðŸŽ‰ All tests passed!' : 'âš ï¸ Some tests failed'}
            `;
        }
        
        async function runAllTests() {
            clearResults();
            
            // Test 1: Check if app.js file loads
            await testScriptLoads();
            
            // Test 2: Check DOM elements exist
            await testDOMElements();
            
            // Test 3: Check CSS loads
            await testCSSLoaded();
            
            // Test 4: Test piece selection functionality
            await testPieceSelection();
            
            // Test 5: Test image upload handler
            await testImageUpload();
            
            // Test 6: Test grid calculation function
            await testGridCalculation();
            
            // Test 7: Test shuffle function
            await testShuffleFunction();
            
            // Test 8: Test jigsaw path creation
            await testJigsawPathFunction();
            
            // Test 9: Test button enable/disable
            await testButtonStates();
            
            // Test 10: Test responsive design
            await testResponsiveDesign();
            
            // Test 11: Test localStorage puzzle saving
            await testPuzzleStorage();
            
            // Test 12: Test piece snapping logic
            await testPieceSnapping();
        }
        
        async function testScriptLoads() {
            try {
                const response = await fetch('app.js');
                const text = await response.text();
                const hasValidJS = text.includes('function') && !text.includes('undefined');
                logTest('JavaScript file loads', hasValidJS, 'app.js is accessible and contains valid JavaScript');
            } catch (e) {
                logTest('JavaScript file loads', false, `Error: ${e.message}`);
            }
        }
        
        async function testDOMElements() {
            try {
                const iframe = document.querySelector('iframe');
                await new Promise(resolve => iframe.addEventListener('load', resolve));
                
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const elements = [
                    'imageInput',
                    'startBtn',
                    'newPuzzleBtn',
                    'setupPanel',
                    'gameArea',
                    'puzzleBoard',
                    'piecesTray',
                    'successMessage'
                ];
                
                const missing = elements.filter(id => !iframeDoc.getElementById(id));
                
                if (missing.length === 0) {
                    logTest('DOM elements exist', true, 'All required DOM elements found');
                } else {
                    logTest('DOM elements exist', false, `Missing elements: ${missing.join(', ')}`);
                }
            } catch (e) {
                logTest('DOM elements exist', false, `Error: ${e.message}`);
            }
        }
        
        async function testCSSLoaded() {
            try {
                const response = await fetch('styles.css');
                const css = await response.text();
                const hasStyles = css.includes('.puzzle-piece') && 
                                 css.includes('.container') && 
                                 css.includes('.btn');
                logTest('CSS file loads', hasStyles, 'styles.css contains all required classes');
            } catch (e) {
                logTest('CSS file loads', false, `Error: ${e.message}`);
            }
        }
        
        async function testPieceSelection() {
            try {
                const iframe = document.querySelector('iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const pieceOptions = iframeDoc.querySelectorAll('.piece-option');
                const hasAllOptions = pieceOptions.length === 8;
                const values = Array.from(pieceOptions).map(el => el.dataset.pieces);
                const expectedValues = ['30', '40', '50', '60', '70', '80', '90', '100'];
                const hasCorrectValues = expectedValues.every(v => values.includes(v));
                
                const passed = hasAllOptions && hasCorrectValues;
                logTest('Piece count options', passed, 
                    `Found ${pieceOptions.length}/8 options with correct values`);
            } catch (e) {
                logTest('Piece count options', false, `Error: ${e.message}`);
            }
        }
        
        async function testImageUpload() {
            try {
                const iframe = document.querySelector('iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const imageInput = iframeDoc.getElementById('imageInput');
                const hasInput = !!imageInput;
                const acceptsImages = imageInput?.accept === 'image/*';
                const hasCapture = imageInput?.hasAttribute('capture');
                
                const passed = hasInput && acceptsImages && hasCapture;
                logTest('Image upload input', passed, 
                    `Input configured correctly for images and camera capture`);
            } catch (e) {
                logTest('Image upload input', false, `Error: ${e.message}`);
            }
        }
        
        async function testGridCalculation() {
            try {
                // Test the grid calculation logic
                const testCases = [
                    { pieces: 30, aspectRatio: 1.5 },
                    { pieces: 50, aspectRatio: 1.33 },
                    { pieces: 100, aspectRatio: 1.77 }
                ];
                
                let allPassed = true;
                testCases.forEach(test => {
                    const cols = Math.round(Math.sqrt(test.pieces * test.aspectRatio));
                    const rows = Math.round(test.pieces / cols);
                    const actual = cols * rows;
                    
                    // Allow small variance due to rounding
                    if (Math.abs(actual - test.pieces) > 10) {
                        allPassed = false;
                    }
                });
                
                logTest('Grid calculation algorithm', allPassed, 
                    'Grid dimensions calculated correctly for various piece counts');
            } catch (e) {
                logTest('Grid calculation algorithm', false, `Error: ${e.message}`);
            }
        }
        
        async function testShuffleFunction() {
            try {
                // Test shuffle maintains array length
                const arr = [1, 2, 3, 4, 5, 6, 7, 8, 9, 10];
                const original = [...arr];
                
                // Simple shuffle implementation for testing
                for (let i = arr.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [arr[i], arr[j]] = [arr[j], arr[i]];
                }
                
                const sameLengthPassed = arr.length === original.length;
                const allElementsPresent = original.every(el => arr.includes(el));
                
                logTest('Shuffle function', sameLengthPassed && allElementsPresent, 
                    'Array shuffling preserves all elements');
            } catch (e) {
                logTest('Shuffle function', false, `Error: ${e.message}`);
            }
        }
        
        async function testJigsawPathFunction() {
            try {
                const response = await fetch('app.js');
                const code = await response.text();
                
                const hasFunction = code.includes('function createJigsawPath');
                const hasBezierCurves = code.includes('bezierCurveTo');
                const hasTabLogic = code.includes('tabTop') && 
                                   code.includes('tabRight') && 
                                   code.includes('tabBottom') && 
                                   code.includes('tabLeft');
                
                const passed = hasFunction && hasBezierCurves && hasTabLogic;
                logTest('Jigsaw piece shape generation', passed, 
                    'Function creates proper jigsaw shapes with tabs');
            } catch (e) {
                logTest('Jigsaw piece shape generation', false, `Error: ${e.message}`);
            }
        }
        
        async function testButtonStates() {
            try {
                const iframe = document.querySelector('iframe');
                const iframeDoc = iframe.contentDocument || iframe.contentWindow.document;
                
                const startBtn = iframeDoc.getElementById('startBtn');
                const isInitiallyDisabled = startBtn.disabled === true;
                
                logTest('Button state management', isInitiallyDisabled, 
                    'Start button is disabled until image is selected');
            } catch (e) {
                logTest('Button state management', false, `Error: ${e.message}`);
            }
        }
        
        async function testResponsiveDesign() {
            try {
                const response = await fetch('styles.css');
                const css = await response.text();
                
                const hasMediaQueries = css.includes('@media');
                const hasMobileStyles = css.includes('max-width: 768px') || 
                                       css.includes('max-width:768px');
                const hasTabletStyles = css.includes('max-width: 1024px') || 
                                       css.includes('max-width:1024px');
                
                const passed = hasMediaQueries && hasMobileStyles;
                logTest('Responsive design', passed, 
                    'CSS includes media queries for mobile and tablet devices');
            } catch (e) {
                logTest('Responsive design', false, `Error: ${e.message}`);
            }
        }
        
        async function testPuzzleStorage() {
            try {
                const response = await fetch('app.js');
                const code = await response.text();
                
                const hasLocalStorage = code.includes('localStorage');
                const hasSaveFunction = code.includes('savePuzzleToLibrary');
                const hasLoadFunction = code.includes('getSavedPuzzles');
                const hasDeleteFunction = code.includes('deletePuzzleFromLibrary');
                
                const passed = hasLocalStorage && hasSaveFunction && hasLoadFunction && hasDeleteFunction;
                logTest('Puzzle storage (localStorage)', passed, 
                    'App can save, load, and delete puzzles from library');
            } catch (e) {
                logTest('Puzzle storage (localStorage)', false, `Error: ${e.message}`);
            }
        }
        
        async function testPieceSnapping() {
            try {
                const response = await fetch('app.js');
                const code = await response.text();
                
                const hasSnapFunction = code.includes('snapPiecesTogether');
                const hasAdjacentCheck = code.includes('checkAndSnapToAdjacentPieces');
                const hasEdgeSnapping = code.includes('checkAndSnapToEdges');
                const hasGroupTracking = code.includes('pieceGroups');
                
                const passed = hasSnapFunction && hasAdjacentCheck && hasEdgeSnapping && hasGroupTracking;
                logTest('Piece snapping mechanics', passed, 
                    'Pieces snap together when adjacent and to board edges');
            } catch (e) {
                logTest('Piece snapping mechanics', false, `Error: ${e.message}`);
            }
        }
        
        // Run tests on page load
        window.addEventListener('load', () => {
            console.log('Test page loaded. Click "Run All Tests" to begin.');
        });
    </script>
</body>
</html>
